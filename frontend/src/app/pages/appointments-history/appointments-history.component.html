<div class="appointments-history">
  @if(!pending){ @for(patient of patients; track patient.email){
  <mat-expansion-panel class="user-card-container">
    <mat-expansion-panel-header class="doctor-card">
      <mat-panel-title
        style="
          display: flex;
          justify-content: space-between;
          align-items: center;
        "
      >
        <div style="display: flex; align-items: center">
          <img src="../../../assets/user.png" alt="" class="user-image" />
          <div class="user-info">
            <h3>{{ patient.appointments[0].fullname }}</h3>
            <h4 style="color: gray; font-size: 12px">
              {{ patient.email }}
            </h4>
          </div>
        </div>
        <button mat-stroked-button class="bg-secondary text-primary">
          Show patient card
        </button>
      </mat-panel-title>
    </mat-expansion-panel-header>
    <div class="card-content">
      <div class="general-info">
        <h2 style="font-weight: bold">General Info</h2>
        <div>
          <span style="font-weight: bold">Total appointments:</span>
          {{ patient.appointments.length }}
        </div>
        <div>
          <span style="font-weight: bold">Email:</span>
          {{ patient.email }}
        </div>
        <div>
          <span style="font-weight: bold">Blood Type:</span>
          {{ patient.bloodType || "-" }}
        </div>
        <div>
          <span style="font-weight: bold">Weight:</span>
          {{ patient.weight || "-" }}
        </div>
        <div>
          <span style="font-weight: bold">Height:</span>
          {{ patient.height || "-" }}
        </div>
        <button
          style="margin-top: 20px"
          mat-flat-button
          color="primary"
          (click)="viewMedicalHistory(patient)"
        >
          View medical history
        </button>
      </div>

      <div class="doctor-notes">
        <div
          style="
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
          "
        >
          <h2 style="margin: 0; font-weight: bold">Your notes</h2>
          <button
            (click)="
              saveNotes(patient.patientId, noteContainer.value, patient.email)
            "
            matTooltip="Save your notes"
            style="margin-top: 10px"
            mat-flat-button
            color="primary"
            class="bg-primary text-secondary"
          >
            Save
          </button>
        </div>
        <mat-form-field
          class="note-container"
          style="width: 100%; height: 200px"
        >
          <mat-label>Add your notes here</mat-label>
          <textarea
            [value]="patient.notes"
            #noteContainer
            style="resize: none"
            type="text"
            required
            matInput
          ></textarea>
          @if(notesPending){
          <div class="loading-spinner">
            <i class="fa-solid fa-spinner fa-spin" style="font-size: 40px"></i>
          </div>
          }
        </mat-form-field>
      </div>
    </div>

    <div class="appointments">
      <app-appointment-list
        [labelSearch]="patient.email"
      ></app-appointment-list>
    </div>
  </mat-expansion-panel>
  } } @if(pending){
  <div class="loading-spinner">
    <mat-spinner></mat-spinner>
  </div>
  }
</div>
